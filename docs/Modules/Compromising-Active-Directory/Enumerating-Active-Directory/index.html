<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Modules/Compromising-Active-Directory/Enumerating-Active-Directory" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Enumerating Active Directory - Active Directory 列举 | TryHackMe CN Mirror</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tryhackmyoffsecbox.github.io/Tryhackme-CN/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tryhackmyoffsecbox.github.io/Tryhackme-CN/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tryhackmyoffsecbox.github.io/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Enumerating-Active-Directory"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Enumerating Active Directory - Active Directory 列举 | TryHackMe CN Mirror"><meta data-rh="true" name="description" content="TryHackMe | Enumerating Active Directory"><meta data-rh="true" property="og:description" content="TryHackMe | Enumerating Active Directory"><link data-rh="true" rel="icon" href="/Tryhackme-CN/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tryhackmyoffsecbox.github.io/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Enumerating-Active-Directory"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Enumerating-Active-Directory" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://tryhackmyoffsecbox.github.io/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Enumerating-Active-Directory" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/Tryhackme-CN/blog/rss.xml" title="TryHackMe CN Mirror RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Tryhackme-CN/blog/atom.xml" title="TryHackMe CN Mirror Atom Feed"><link rel="stylesheet" href="/Tryhackme-CN/assets/css/styles.351040f8.css">
<script src="/Tryhackme-CN/assets/js/runtime~main.2cc0ba3b.js" defer="defer"></script>
<script src="/Tryhackme-CN/assets/js/main.14bf6526.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Tryhackme-CN/"><div class="navbar__logo"><img src="/Tryhackme-CN/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Tryhackme-CN/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Tryhackme CN Mirror</b></a><a class="navbar__item navbar__link" href="/Tryhackme-CN/docs/LearningPaths/">Learning Paths</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Tryhackme-CN/docs/Modules/">Modules</a><a class="navbar__item navbar__link" href="/Tryhackme-CN/docs/Networks/">Networks</a><a class="navbar__item navbar__link" href="/Tryhackme-CN/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Tryhackme-CN/docs/Modules/">Modules - 模块</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/">Compromising Active Directory - 妥协活动目录</a><button aria-label="折叠侧边栏分类 &#x27;Compromising Active Directory - 妥协活动目录&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Active-Directory-Basics">Active Directory Basics - Active Directory 基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Breaching-Active-Directory">Breaching Active Directory - Active Directory 突破</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Enumerating-Active-Directory">Enumerating Active Directory - Active Directory 列举</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Lateral-Movement-and-Pivoting">Lateral Movement and Pivoting - 横向移动和枢纽</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Exploiting-Active-Directory">Exploiting Active Directory - Active Directory 利用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Persisting-Active-Directory">Persisting Active Directory - Active Directory 持久化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Credentials-Harvesting">Credentials Harvesting - 凭据收集</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Tryhackme-CN/docs/Modules/Shells-and-Privilege-Escalation/">Shells and Privilege Escalation - Shell 和特权提升</a><button aria-label="展开侧边栏分类 &#x27;Shells and Privilege Escalation - Shell 和特权提升&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/Tryhackme-CN/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/"><span itemprop="name">Compromising Active Directory - 妥协活动目录</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Enumerating Active Directory - Active Directory 列举</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Enumerating Active Directory - Active Directory 列举</h1>
<blockquote>
<p><a href="https://tryhackme.com/room/adenumeration" target="_blank" rel="noopener noreferrer">TryHackMe | Enumerating Active Directory</a></p>
<p>Updated in 2023-12-10</p>
<p>该房间涵盖各种 Active Directory 枚举技术、使用案例和缺点。</p>
<p>This room covers various Active Directory enumeration techniques, their use cases as well as drawbacks.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-ad-enumeration---为什么要进行-ad-域枚举">Why AD Enumeration - 为什么要进行 AD 域枚举<a href="#why-ad-enumeration---为什么要进行-ad-域枚举" class="hash-link" aria-label="Why AD Enumeration - 为什么要进行 AD 域枚举的直接链接" title="Why AD Enumeration - 为什么要进行 AD 域枚举的直接链接">​</a></h2>
<p>现在我们已经有了第一套有效的 Active Directory（AD 域）凭证，我们将探索用于枚举 AD 的不同方法。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ad-域枚举">AD 域枚举<a href="#ad-域枚举" class="hash-link" aria-label="AD 域枚举的直接链接" title="AD 域枚举的直接链接">​</a></h3>
<p>一旦我们拥有了第一组 AD 域凭据以及在网络上使用它们进行身份验证的方法，一个全新的世界就会展现在我们面前！我们可以通过认证访问，甚至是超级低权限访问，开始列举有关 AD 域设置和结构的各种细节。</p>
<p>在红队参与期间，这通常会导致我们能够执行某种形式的权限升级或横向移动，以获得更多访问权限，直到我们拥有足够的权限来执行并实现我们的目标。在大多数情况下，枚举和利用是紧密联系在一起的。一旦利用了枚举阶段显示的攻击路径，就会从新的特权位置再次执行枚举，如下图所示。</p>
<div style="text-align:center"><p><img loading="lazy" alt="通过枚举规划攻击路径" src="/Tryhackme-CN/assets/images/image_20231233-123344-3f302e096d708f34a2f07c71bc221c7a.png" width="920" height="410" class="img_ev3q"></p></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="学习目标">学习目标<a href="#学习目标" class="hash-link" aria-label="学习目标的直接链接" title="学习目标的直接链接">​</a></h3>
<p>在本网络中，我们将介绍几种可用于枚举 AD 的方法。这绝不是一份完整的清单，因为可用的方法通常具有很强的情景性，并取决于所获取的漏洞。不过，我们将介绍以下用于枚举 AD 的技术：</p>
<ul>
<li>Microsoft 管理控制台的 AD 快速插件。</li>
<li>命令提示符的 net 命令。</li>
<li>PowerShell 的 AD-RSAT cmdlets。</li>
<li>Bloodhound</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="获得初始凭据">获得初始凭据<a href="#获得初始凭据" class="hash-link" aria-label="获得初始凭据的直接链接" title="获得初始凭据的直接链接">​</a></h3>
<p>访问：<code>http://distributor.za.tryhackme.com/creds</code>，即可得到初始的凭据：</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Your credentials have been generated: Username: andrea.mitchell Password: Password1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通过 SSH 测试凭据有效性：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh za.tryhackme.com\\andrea.mitchell@thmjmp1.za.tryhackme.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="credential-injection---凭证注入">Credential Injection - 凭证注入<a href="#credential-injection---凭证注入" class="hash-link" aria-label="Credential Injection - 凭证注入的直接链接" title="Credential Injection - 凭证注入的直接链接">​</a></h2>
<p>在跳转到 AD 对象和枚举之前，我们先来谈谈凭证注入方法。从 &quot;入侵 AD 网络&quot; 中，你会发现，通常在不入侵域连接机器的情况下就能找到凭据。特定的枚举技术可能需要特定的设置才能发挥作用。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows-vs-linux">Windows vs Linux<a href="#windows-vs-linux" class="hash-link" aria-label="Windows vs Linux的直接链接" title="Windows vs Linux的直接链接">​</a></h3>
<p>&quot;知己知彼，百战不殆。知己不  知彼，百战不殆&quot;。- 孙子兵法。</p>
<p>在 Kali 上进行 AD 域枚举，你可以走得非常远。但是，如果你真的想进行深入的查证甚至是利用，你就需要了解并模仿你的敌人。因此，你需要一台 Windows 机器。这将允许我们使用几种内置方法来进行枚举和利用。在本网络中，我们将探索这些内置工具之一，即 <code>runas.exe</code> 二进制程序。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="何为-runas">何为 Runas<a href="#何为-runas" class="hash-link" aria-label="何为 Runas的直接链接" title="何为 Runas的直接链接">​</a></h3>
<p>您是否曾经找到了 AD 域凭据却无处登录？Runas 可能就是您一直在寻找的答案！</p>
<p>在安全评估中，您经常会有网络访问权限，并且刚刚发现了 AD 凭据，但却没有创建新的域连接机器的方法或权限。因此，我们需要在我们控制的 Windows 机器上使用这些凭据的能力。</p>
<p>如果我们拥有 用户名: 密码 格式的 AD 凭据，就可以使用 Runas（一种合法的 Windows 二进制程序）将凭据注入内存。通常的 Runas 命令是这样的</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">runas.exe /netonly /user:&lt;domain&gt;\&lt;username&gt; cmd.exe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>让我们来看看参数：</p>
<ul>
<li>/netonly - 由于我们没有加入域，因此我们希望加载网络身份验证凭据，但不对域控制器进行身份验证。因此，在计算机本地执行的命令将在标准 Windows 账户的上下文中运行，但任何网络连接都将使用此处指定的账户。</li>
<li>/user - 在这里，我们提供域和用户名的详细信息。使用完全合格域名（FQDN）而不只是域的 NetBIOS 名称总是比较安全的，因为这将有助于解析。</li>
<li>cmd.exe - 这是注入凭证后要执行的程序。可以将其更改为任何程序，但最安全的选择是 cmd.exe，因为你可以用它来启动任何你想启动的程序，并注入凭据。</li>
</ul>
<p>运行该命令后，系统将提示您输入密码。请注意，由于我们添加了 /netonly 参数，凭据将不会直接由域控制器验证，因此它将接受任何密码。我们仍需确认网络凭据已成功正确加载。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>如果使用自己的 Windows 机器，应确保以管理员身份运行第  一个命令提示符。这将向 CMD 注入管理员令牌。如果您从 Runas 生成的 CMD 中运行需要本地管理员权限的工具，则令牌已经可用。这并不会赋予你在网络上的管理权限，但会确保你执行的任何本地命令都将以管理权限执行。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="its-always-dns">It&#x27;s Always DNS<a href="#its-always-dns" class="hash-link" aria-label="It&#x27;s Always DNS的直接链接" title="It&#x27;s Always DNS的直接链接">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>只有在使用自己的 Windows 机器进行演习时，才需要执行接下来的这些步骤。不过，学习如何执行这些步骤也是一项很好的知识，因为它可能会对红队演习有所帮助。</p></div></div>
<p>提供密码后，将打开一个新的命令提示符窗口。现在，我们仍然需要验证我们的凭据是否有效。最可靠的方法是列出 SYSVOL。任何 AD 域账户，无论权限多低，都可以读取 SYSVOL 目录的内容。</p>
<p>SYSVOL 是一个存在于所有域控制器上的文件夹。它是一个共享文件夹，用于存储组策略对象（GPO）和信息以及任何其他域相关脚本。它是 Active Directory 的重要组成部分，因为它将这些 GPO 传递给域中的所有计算机  。然后，连接域的计算机就可以读取这些 GPO 并应用适用的 GPO，从而从一个中心位置对整个域的配置进行更改。</p>
<p>在列出 SYSVOL 之前，我们需要配置 DNS。有时你很幸运，内部 DNS 会通过 DHCP 或 VPN 连接自动为你配置，但并不总是如此（比如 TryHackMe 网络）。了解如何手动配置是有好处的。最安全的 DNS 服务器通常是域控制器。使用域控制器的 IP，我们可以在 PowerShell 窗口中执行以下命令：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">$dnsip</span><span class="token plain"> = </span><span class="token string" style="color:#e3116c">&quot;&lt;DC IP&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$index</span><span class="token plain"> = </span><span class="token function" style="color:#d73a49">Get-NetAdapter</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Name </span><span class="token string" style="color:#e3116c">&#x27;Ethernet&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Select-Object</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ExpandProperty </span><span class="token string" style="color:#e3116c">&#x27;ifIndex&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">Set-DnsClientServerAddress</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">InterfaceIndex </span><span class="token variable" style="color:#36acaa">$index</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ServerAddresses </span><span class="token variable" style="color:#36acaa">$dnsip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当然，&quot;Ethernet&quot; 指的是与 TryHackMe 网络连接的任何接口。我们可以运行以下程序来验证 DNS 是否正常工作：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Command Prompt</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\&gt; nslookup za.tryhackme.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>现在应该解析到 DC IP，因为这是 FQDN 的托管地址。现在 DNS 已经正常工作，我们终于可以测试我们的凭据了。我们可以使用以下命令强制基于网络的 SYSVOL 目录列表：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Command Prompt</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Tools&gt;dir \\za.tryhackme.com\SYSVOL\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Volume in drive \\za.tryhackme.com\SYSVOL is Windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Volume Serial Number is 1634-22A9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Directory of \\za.tryhackme.com\SYSVOL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02/24/2022  09:57 PM    &lt;DIR&gt;          .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02/24/2022  09:57 PM    &lt;DIR&gt;          ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02/24/2022  09:57 PM    &lt;JUNCTION&gt;     za.tryhackme.com [C:\Windows\SYSVOL\domain]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               0 File(s)              0 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               3 Dir(s)  51,835,408,384 bytes free</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们现在不会对 SYSVOL 的内容进行过多的深入探讨，但要注意的是，枚举其内容也是很有好处的，因为那里可能还潜藏着一些额外的 AD 域凭据。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ip-vs-hostnames">IP vs Hostnames<a href="#ip-vs-hostnames" class="hash-link" aria-label="IP vs Hostnames的直接链接" title="IP vs Hostnames的直接链接">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Question</div><div class="admonitionContent_BuS1"><p><code>dir \\za.tryhackme.com\SYSVOL</code> 和 <code>dir \\&lt;DC IP&gt;\SYSVOL</code> 之间有区别吗？</p></div></div>
<p>这两者之间有很大区别，归根结底是所使用的身份验证方法不同。当我们提供主机名时，网络身份验证会首先尝试执行 Kerberos 身份验证。由于 Kerberos 身份验证使用的是嵌入在票据中的主机名，如果我们提供 IP，就可以强制将身份验证类型改为 NTLM。虽然从表面上看，这对我们现在来说并不重要，但了解这些细微差别还是有好处的，因为它们可以让你在红队评估期间保持更隐蔽的身份。在某些情况下，组织会监控 OverPass- 和 Pass-The-Hash 攻击。在这种情况下，强制 NTLM 身份验证是避免被发现的好办法。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用注入的凭据">使用注入的凭据<a href="#使用注入的凭据" class="hash-link" aria-label="使用注入的凭据的直接链接" title="使用注入的凭据的直接链接">​</a></h3>
<p>现在，我们已将 AD 域凭据注入内存，好戏才刚刚开始。使用 /netonly 选项后，所有网络通信都将使用注入的凭据进行身份验证。这包括从命令提示符窗口执行的应用程序的所有网络通信。</p>
<p>这就是它的威力所在。你是否遇到过 MS SQL 数据库使用 Windows 身份验证，而你没有域连接的情况？从该命令提示符启动 MS SQL Studio；即使它显示的是您的本地用户名，单击 &quot;登录&quot;，它也会在后台使用 AD 凭据进行身份验证！我们甚至可以用它来 <a href="https://labs.f-secure.com/blog/pth-attacks-against-ntlm-authenticated-web-applications/" target="_blank" rel="noopener noreferrer">对使用 NTLM 身份验证的网络应用程序进行身份验证</a>。</p>
<p>我们将在下一个任务中使用它来实现第一个 AD 枚举技术。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><p>有哪些本地 Windows 二进制程序允许我们将凭据合法注入内存？</p><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">runas.exe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>runas 二进制文件的哪个参数选项将确保注入的凭据用于所有网络连接？</p><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/netonly</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>任何经过身份验证的 AD 帐户都可以访问域控制器上的哪个网络文件夹并存储 GPO 信息？</p><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SYSVOL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行 <code>dir \\za.tryhackme.com\SYSVOL</code> 时，默认执行什么类型的身份验证？</p><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Kerberos authentication</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enumeration-through-microsoft-management-console---通过-microsoft-管理控制台进行枚举">Enumeration through Microsoft Management Console - 通过 Microsoft 管理控制台进行枚举<a href="#enumeration-through-microsoft-management-console---通过-microsoft-管理控制台进行枚举" class="hash-link" aria-label="Enumeration through Microsoft Management Console - 通过 Microsoft 管理控制台进行枚举的直接链接" title="Enumeration through Microsoft Management Console - 通过 Microsoft 管理控制台进行枚举的直接链接">​</a></h2>
<p>在本任务中，将假定您了解这些对象是什么。使用 RDP 和任务 1 中提供的凭据连接到 THMJMP1 以执行此任务。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="microsoft-management-console">Microsoft Management Console<a href="#microsoft-management-console" class="hash-link" aria-label="Microsoft Management Console的直接链接" title="Microsoft Management Console的直接链接">​</a></h3>
<p>在这个任务中，我们将探索我们的第一种枚举方法，这是直到最后一个任务才会使用 GUI 的唯一方法。我们将使用 Microsoft Management Console（MMC）与远程服务器管理工具（RSAT）的 AD Snap-Ins。如果你使用提供的 Windows 虚拟机（THMJMP1），它已经为你安装好了。但是，如果你使用自己的 Windows 机器，你可以按照以下步骤安装 Snap-Ins：</p>
<ol>
<li>按下 “开始”</li>
<li>搜索 “应用和功能” 并按回车</li>
<li>点击 “管理可选功能”</li>
<li>点击 “添加功能”</li>
<li>搜索 “RSAT”</li>
<li>选择 “RSAT：Active Directory 域服务和轻量级目录工具”，然后点击 “安装”</li>
</ol>
<p>你可以通过使用 Windows 开始按钮，搜索运行，并输入 MMC 来启动 MMC。如果我们只是正常运行 MMC，它不会起作用，因为我们的计算机没有加入域，我们的本地账户无法用于域身份验证。</p>
<div style="text-align:center"><p><img loading="lazy" alt="MMC 未加入到域 报错" src="/Tryhackme-CN/assets/images/image_20231229-132907-4122fdc10a6563c8cc44c0f606a55397.png" width="723" height="349" class="img_ev3q"></p></div>
<p>这就是之前任务中的 Runas 窗口发挥作用的地方。在那个窗口中，我们可以启动 MMC，这将确保所有 MMC 网络连接都使用我们注入的 AD 凭据。</p>
<p>在 MMC 中，现在我们可以附加 AD RSAT Snap-In：</p>
<ol>
<li>点击 “文件” -&gt; “添加 / 移除控件”</li>
<li>选择并添加所有三个 Active Directory 控件</li>
<li>点击通过任何错误和警告</li>
<li>在 “Active Directory Domains and Trusts” 上右键，并选择 “更改域”</li>
<li>输入 za.tryhackme.com 作为根域，然后点击 “确定”</li>
<li>在 “Active Directory Sites and Services” 上右键，并选择 “更改域”</li>
<li>输入 za.tryhackme.com 作为根域，然后  点击 “确定”</li>
<li>在 “Active Directory Users and Computers” 上右键，并选择 “更改域”</li>
<li>输入 za.tryhackme.com 作为域，然后点击 “确定”</li>
<li>在左侧窗格中对 “Active Directory Users and Computers” 右键</li>
<li>点击 “查看” -&gt; “高级功能”</li>
</ol>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><p>打开 MMC，在 <code>File</code>  -&gt; <code>Add/Remove Snap-in</code> 中，添加 Active Directory 控件</p><div style="text-align:center"><p><img loading="lazy" alt="MMC 添加 Active Directory 控件" src="/Tryhackme-CN/assets/images/image_20231243-134323-b5442abb1b47864651d205d6607d9e22.png" width="1320" height="787" class="img_ev3q"></p></div><p>右键 <code>Active Directory Domains and Trusts</code> ，更改域</p><div style="text-align:center"><p><img loading="lazy" alt="Active Directory Domains and Trusts 更改域" src="/Tryhackme-CN/assets/images/image_20231246-134651-d82089504f5fbf7d7c340552b9e27c5c.png" width="1320" height="787" class="img_ev3q"></p></div><p>接下来，对 <code>Active Directory Sites and Services</code> 和 <code>Active Directory Users and Computers</code> 也进行相同的操作，更改域的配置</p></div></div></details>
<p>如果到目前为止一切都正常工作，你的 MMC 现在应该指向并已经通过验证连接到目标域：</p>
<div style="text-align:center"><p><img loading="lazy" alt="MMC 加入到域" src="/Tryhackme-CN/assets/images/image_20231230-133055-1ea5b4fc4c0dda73a30dc781b138e60f.png" width="640" height="180" class="img_ev3q"></p></div>
<p>现在我们可以开始枚举这里关于 AD 结构的信息。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="users-and-computers">Users and Computers<a href="#users-and-computers" class="hash-link" aria-label="Users and Computers的直接链接" title="Users and Computers的直接链接">​</a></h3>
<p>让  我们来看看 Active Directory 结构。在这个任务中，我们将专注于 AD 用户和计算机。展开该控件并展开 za 域，以查看初始的组织单位（OU，Organisational Unit）结构：</p>
<div style="text-align:center"><p><img loading="lazy" alt="MMC 查看 OU" src="/Tryhackme-CN/assets/images/image_20231231-133149-43c8921710153e7f857f68998b7c04ae.png" width="407" height="387" class="img_ev3q"></p></div>
<p>让我们来看看 “People” 目录。在这里，我们可以看到用户根据部门组织单位进行了划分。点击每个部门的 OU 将会显示属于该部门的用户。</p>
<div style="text-align:center"><p><img loading="lazy" alt="MMC 查看 People" src="/Tryhackme-CN/assets/images/image_20231232-133246-970afc205c7af58cd5216711e57d2b8d.png" width="619" height="516" class="img_ev3q"></p></div>
<p>点击任何一个用户都可以让我们查看他们所有的属性和特性。我们还可以看到他们所属的组：</p>
<div style="text-align:center"><p><img loading="lazy" alt="MMC 查看 People Member of" src="/Tryhackme-CN/assets/images/image_20231233-133329-b64fad51e4019a885b188ac7188e416e.png" width="389" height="119" class="img_ev3q"></p></div>
<p>我们也可以使用 MMC 来查找环境中的主机。如果我们点击 “服务器” 或 “工作站”，将显示域加入的机器列表。</p>
<div style="text-align:center"><p><img loading="lazy" alt="MMC 查看 Servers" src="/Tryhackme-CN/assets/images/image_20231234-133402-3cfa5e4334979e4a4f75187c1f18f3b7.png" width="777" height="482" class="img_ev3q"></p></div>
<p>如果我们有相关权限，还可以使用 MMC 直接对 AD 进行更改，比如更改用户密码或将账户添加到特定组中。尝试使用 MMC 进行操作，更好地了解 AD 域结构。利用搜索功能查找对象。</p>
<p>优点：</p>
<ul>
<li>GUI 提供了全面了解 AD 环境的优秀方法。</li>
<li>可以快速搜索不同的 AD 对象。</li>
<li>它提供了直接查看 AD 对象特定更新的方法。</li>
<li>如果我们有足够的权限，可以直接更新现有的 AD 对象或添加新的对象。</li>
</ul>
<p>缺点：</p>
<ul>
<li>GUI 需要对执行它的机器进行远程桌面访问（RDP）。</li>
<li>尽管搜索对象很快，但无法收集 AD 全局属性或特性。</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><p>有多少个计算机对象属于 Servers OU？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img loading="lazy" alt="MMC Servers OU" src="/Tryhackme-CN/assets/images/image_20231253-135346-2ae2d9ea18bcd05d07b05d1ed48d6bc7.png" width="1320" height="787" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>有多少计算机对象属于 Workstations OU？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img loading="lazy" alt="MMC Workstations OU" src="/Tryhackme-CN/assets/images/image_20231252-135236-ac5cf4051538d04adae297823f73b25a.png" width="1320" height="787" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该组织由多少个部门（组织单位）组成？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img loading="lazy" alt="MMC People OU" src="/Tryhackme-CN/assets/images/image_20231254-135436-4628f6e31dc26897601e74efec68f402.png" width="1320" height="787" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该组织有多少个管理级别？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img loading="lazy" alt="MMC Admin OU" src="/Tryhackme-CN/assets/images/image_20231255-135512-7f1389ce86b292c266bfd417c23f28c2.png" width="1320" height="787" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>t0_tinus.green</code> 帐户的描述属性中存储的标志值是多少？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img loading="lazy" alt="MMC Admin T0 green" src="/Tryhackme-CN/assets/images/image_20231257-135712-80ca1d48f78a8765e1b23e5f0c28976f.png" width="1320" height="787" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">THM{Enumerating.Via.MMC}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enumeration-through-command-prompt---通过命令提示符进行枚举">Enumeration through Command Prompt - 通过命令提示符进行枚举<a href="#enumeration-through-command-prompt---通过命令提示符进行枚举" class="hash-link" aria-label="Enumeration through Command Prompt - 通过命令提示符进行枚举的直接链接" title="Enumeration through Command Prompt - 通过命令提示符进行枚举的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="命令提示符">命令提示符<a href="#命令提示符" class="hash-link" aria-label="命令提示符的直接链接" title="命令提示符的直接链接">​</a></h3>
<p>有时候你只需要快速、简单地进行 AD 查找，命令提示符就能帮上忙。老实可靠的 CMD 在某些情况下非常方便，比如你可能没有对系统的远程桌面访问权限，防御者正在监控 PowerShell 的使用，而你需要通过远程访问木马（RAT）执行 AD 枚举。甚至在你的钓鱼载荷中嵌入几个简单的 AD 枚举命令也能帮助你获取关键信息，帮助你策划最终攻击。</p>
<p>CMD 有一个内置命令可以用来枚举关于 AD 的信息，就是 <code>net</code> 命令。<code>net</code> 命令是一个方便的工具，用来枚举关于本地系统和 AD 的信息。我们将看一些我们可以从这个位置枚举到的有趣信息，但这并不是一个详尽的清单。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>在这个任务中，你将需要使用 THMJMP1，无法使用你自己的 Windows 虚拟机。这将在缺点部分进行解释。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="users">Users<a href="#users" class="hash-link" aria-label="Users的直接链接" title="Users的直接链接">​</a></h3>
<p>我们可以使用 <code>net</code> 命令并通过 <code>user</code> 子选项列出 AD 域中的所有用户：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Command Prompt</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\&gt;net user /domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The request will be processed at a domain controller for domain za.tryhackme.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User accounts for \\THMDC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aaron.conway             aaron.hancock            aaron.harris</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aaron.johnson            aaron.lewis              aaron.moore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aaron.patel              aaron.smith              abbie.joyce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">abbie.robertson          abbie.taylor             abbie.walker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">abdul.akhtar             abdul.bates              abdul.holt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">abdul.jones              abdul.wall               abdul.west</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">abdul.wilson             abigail.cox              abigail.cox1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">abigail.smith            abigail.ward             abigail.wheeler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[....]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The command completed successfully.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这将为我们返回所有 AD 用户，并有助于确定域的规模以策划进一步的攻击。我们还可以使用这个子选项来枚举关于单个用户账户的更详细信息：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Command Prompt</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\&gt;net user zoe.marshall /domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The request will be processed at a domain controller for domain za.tryhackme.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User name                    zoe.marshall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Full Name                    Zoe Marshall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User&#x27;s comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Country/region code          000 (System Default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Account active               Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Account expires              Never</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password last set            2/24/2022 10:06:06 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password expires             Never</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password changeable          2/24/2022 10:06:06 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password required            Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User may change password     Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Workstations allowed         All</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Logon script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Home directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last logon                   Never</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Logon hours allowed          All</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Local Group Memberships</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Global Group memberships     *Domain Users         *Internet Access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The command completed successfully.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制 代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>如果用户只属于少量的 AD 组，这个命令可以显示组成员资格。然而，通常情况下，如果超过十个组成员资格，该命令将无法列出所有的成员资格。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="groups">Groups<a href="#groups" class="hash-link" aria-label="Groups的直接链接" title="Groups的直接链接">​</a></h3>
<p>我们可以使用 <code>net</code> 命令并通过 <code>group</code> 子选项枚举域中的组：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Command Prompt</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\&gt;net group /domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The request will be processed at a domain controller for domain za.tryhackme.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Group Accounts for \\THMDC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Cloneable Domain Controllers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*DnsUpdateProxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Domain Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Domain Computers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Domain Controllers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Domain Guests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Domain Users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Schema Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Server Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Tier 0 Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Tier 1 Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*Tier 2 Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The command completed successfully.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这些信息可以帮助我们找到特定的组，以便执行目标。我们还可以通过在同一命令中指定组来枚举更多细节，比如成员身份：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Command Prompt</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\&gt;net group &quot;Tier 1 Admins&quot; /domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The request will be processed at a domain controller for domain za.tryhackme.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Group name     Tier 1 Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Members</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t1_arthur.tyler          t1_gary.moss             t1_henry.miller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t1_jill.wallis           t1_joel.stephenson       t1_marian.yates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t1_rosie.bryant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The command completed successfully.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="password-policy">Password Policy<a href="#password-policy" class="hash-link" aria-label="Password Policy的直接链接" title="Password Policy的直接链接">​</a></h3>
<p>我们可以使用 <code>net</code> 命令并通过 <code>accounts</code> 子选项枚举域的密码策略：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Command Prompt</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\&gt;net accounts /domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The request will be processed at a domain controller for domain za.tryhackme.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Force user logoff how long after time expires?:       Never</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Minimum password age (days):                          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Maximum password age (days):                          Unlimited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Minimum password length:                              0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Length of password history maintained:                None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Lockout threshold:                                    Never</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Lockout duration (minutes):                           30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Lockout observation window (minutes):                 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Computer role:                                        PRIMARY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The command completed successfully.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这将为我们提供有用的信息，例如：</p>
<ul>
<li>保存密码历史的长度。即用户在可以重新使用旧密码之前必须提供多少个唯一的密码。</li>
<li>错误密码尝试的锁定阈值以及账户被锁定的时长。</li>
<li>密码的最小长度。</li>
<li>密码允许的最大年龄，指示密码是否需要定期更换。</li>
</ul>
<p>如果我们想对我们已枚举的其他用户账户进行额外的密码喷洒攻击，这些信息对我们有利。它可以帮助我们更好地猜测我们在攻击中应该使用哪些单一密码，以及在我们冒着风险锁定账户之前可以运行多少次攻击。然而，需要注意的是，如果我们执行盲目的密码喷洒攻击，可能会仍然锁定账户，因为我们没有检查确定该特定账户在被锁定之前还剩多少次尝试机会。</p>
<p>你可以在 <a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/net-commands-on-operating-systems" target="_blank" rel="noopener noreferrer">Net Commands On Operating Systems - Microsoft Learn</a> 找到与 <code>net</code> 命令相关的全部选项范围。尝试使用这些 <code>net</code> 命令来收集关于特定用户和组的信息。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="优点">优点<a href="#优点" class="hash-link" aria-label="优点的直接链接" title="优点的直接链接">​</a></h3>
<ul>
<li>无需额外或外部工具，这些简单命令通常不会受到蓝队的监控。</li>
<li>我们不需要 GUI 来进行这种枚举。</li>
<li>VBScript 和其他经常用于钓鱼载荷的宏语言原生支持这些命令，因此它们可以用于枚举关于 AD 域的初始信息，然后再制作更具体的载荷。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="缺点">缺点<a href="#缺点" class="hash-link" aria-label="缺点的直接链接" title="缺点的直接链接">​</a></h3>
<ul>
<li><code>net</code> 命令必须从加入域的机器上执行。如果机器没有加入域，它将默认为 WORKGROUP 域。</li>
<li><code>net</code> 命令可能不会显示所有信息。例如，如果用户是超过十个组的成员，则不会在输出中显示所有这些组。</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><p>除了 <code>Domain Users</code> 组外，<code>aaron.harris</code> 账户还是哪个组的成员？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img loading="lazy" alt="MMC aaron.harris Member of" src="/Tryhackme-CN/assets/images/image_20231221-142146-b36b952e6db1e60a4d9d3f610ebf77d4.png" width="1320" height="787" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Internet Access</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Guest</code> 账户是否处于激活状态？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img loading="lazy" alt="MMC Account Guest status" src="/Tryhackme-CN/assets/images/image_20231229-142917-fa089a5889301438fb48675b7a776e23.png" width="1320" height="787" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Nay</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>有多少账户是 <code>Admins Tier 1</code> 组的成员？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img loading="lazy" alt="MMC Account Admins T1" src="/Tryhackme-CN/assets/images/image_20231230-143024-19067ed98552c3121a32c822f1ebc789.png" width="1320" height="787" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当前密码策略的账户锁定时长是多少分钟？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img loading="lazy" alt="net accounts /domain" src="/Tryhackme-CN/assets/images/image_20231231-143129-a1a6e945f49caa073506f2385e6a90e0.png" width="1320" height="787" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">30</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enumeration-through-powershell---通过-powershell-进行枚举">Enumeration through PowerShell - 通过 PowerShell 进行枚举<a href="#enumeration-through-powershell---通过-powershell-进行枚举" class="hash-link" aria-label="Enumeration through PowerShell - 通过 PowerShell 进行枚举的直接链接" title="Enumeration through PowerShell - 通过 PowerShell 进行枚举的 直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="powershell">Powershell<a href="#powershell" class="hash-link" aria-label="Powershell的直接链接" title="Powershell的直接链接">​</a></h3>
<p>PowerShell 是命令提示符的升级版。微软于 2006 年首次发布了它。虽然 PowerShell 具备命令提示符的所有标准功能，但它还提供了访问 cmdlets（读作 command-lets）的能力，这些是用于执行特定功能的 .NET 类。虽然我们可以编写自己的 cmdlets，就像 <a href="https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerView" target="_blank" rel="noopener noreferrer">PowerView</a> 的创建者所做的那样，但我们已经可以通过使用内置的 cmdlet 取得非常大的进展。</p>
<p>由于我们在任务 3 中安装了 AD-RSAT 工具，它自动为我们安装了相关的 cmdlets。安装了 50 多个 cmdlets。我们将研究其中一些，但完整的 cmdlets 列表请参考这个 <a href="https://learn.microsoft.com/en-us/powershell/module/activedirectory/?view=windowsserver2022-ps" target="_blank" rel="noopener noreferrer">ActiveDirectory - Microsoft Learns</a> 。</p>
<p>通过我们的 SSH 终端，我们可以使用以下命令将其升级为 PowerShell 终端：<code>powershell</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="users-1">Users<a href="#users-1" class="hash-link" aria-label="Users的直接链接" title="Users的直接链接">​</a></h3>
<p>我们可以使用 Get-ADUser cmdlet 枚举 AD 用户：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">SSH PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt; </span><span class="token function" style="color:#d73a49">Get-ADUser</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Identity gordon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Properties </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AccountExpirationDate                :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">accountExpires                       : 9223372036854775807</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AccountLockoutTime                   :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deleted                              :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Department                           : Consulting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description                          :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DisplayName                          : Gordon Stevens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DistinguishedName                    : CN=gordon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Consulting</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=People</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>参数用于以下目的：</p>
<ul>
<li>-Identity：我们正在枚举的账户名称</li>
<li>-Properties：将显示与账户相关的哪些属性，* 将显示所有属性</li>
<li>-Server：由于我们没有加入域，我们必须使用此参数将其指向我们的域控制器</li>
</ul>
<p>对于大多数这些 cmdlet，我们还可以使用 <code>-Filter</code> 参数来更精确地控制枚举，并使用 <code>Format-Table</code> cmdlet 来整齐地显示结果，如下所示：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">SSH PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt; </span><span class="token function" style="color:#d73a49">Get-ADUser</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">Filter</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Name -like&quot;*stevens&quot;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Format-Table</span><span class="token plain"> Name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">SamAccountName </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name             SamAccountName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">             </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chloe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens    chloe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">samantha</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens samantha</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">janice</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens   janice</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gordon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens   gordon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="groups-1">Groups<a href="#groups-1" class="hash-link" aria-label="Groups的直接链接" title="Groups的直接链接">​</a></h3>
<p>我们可以使用 Get-ADGroup cmdlet 枚举 AD 组：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">SSH PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt; </span><span class="token function" style="color:#d73a49">Get-ADGroup</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Identity Administrators </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DistinguishedName : CN=Administrators</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">CN=Builtin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GroupCategory     : Security</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GroupScope        : DomainLocal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name              : Administrators</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectClass       : </span><span class="token function" style="color:#d73a49">group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectGUID        : f4d1cbcd-4a6f-4531-8550-0394c3273c4f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SamAccountName    : Administrators</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SID               : S-1-5-32-544</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们还可以使用 Get-ADGroupMember cmdlet 枚举组成员资格：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">SSH PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt; </span><span class="token function" style="color:#d73a49">Get-ADGroupMember</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Identity Administrators </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">distinguishedName : CN=Domain Admins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">CN=Users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name              : Domain Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objectClass       : </span><span class="token function" style="color:#d73a49">group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objectGUID        : 8a6186e5-e20f-4f13-b1b0-067f3326f67c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SamAccountName    : Domain Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SID               : S-1-5-21-3330634377-1326264276-632209373-512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">distinguishedName : CN=Administrator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">CN=Users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com name              : Administrator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objectClass       : user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objectGUID        : b10fe384-bcce-450b-85c8-218e3c79b30fSamAccountName    : Administrator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SID               : S-1-5-21-3330634377-1326264276-632209373-500</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ad-objects">AD Objects<a href="#ad-objects" class="hash-link" aria-label="AD Objects的直接链接" title="AD Objects的直接链接">​</a></h3>
<p>使用 <code>Get-ADObject</code> cmdlet 可以执行更通用的搜索来查找任何 AD 对象。例如，如果我们要查找在特定日期之后更改的所有 AD 对象：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">SSH PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt; </span><span class="token variable" style="color:#36acaa">$ChangeDate</span><span class="token plain"> = </span><span class="token function" style="color:#d73a49">New-Object</span><span class="token plain"> DateTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">2022</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 02</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 28</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 00</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 00</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt; </span><span class="token function" style="color:#d73a49">Get-ADObject</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">Filter</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;whenChanged -gt $ChangeDate&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">includeDeletedObjects </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deleted           :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DistinguishedName : DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name              : za</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectClass       : domainDNS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectGUID        : 518ee1e7-f427-4e91-a081-bb75e655ce7a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deleted           :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DistinguishedName : CN=Administrator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">CN=Users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name              : Administrator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectClass       : user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectGUID        : b10fe384-bcce-450b-85c8-218e3c79b30f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果我们想要执行密码喷洒攻击但又不想锁定账户，我们可以使用这个命令来枚举 badPwdCount 大于 0 的账户，避免在我们的攻击中使用这些账户：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">SSH PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt; </span><span class="token function" style="color:#d73a49">Get-ADObject</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">Filter</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;badPwdCount -gt 0&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这仅会显示如果网络中的某个用户多次错误地输入了密码的结果。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="domains">Domains<a href="#domains" class="hash-link" aria-label="Domains的直接链接" title="Domains的直接链接">​</a></h3>
<p>我们可以使用 <code>Get-ADDomain</code> 来检索关于特定域的特定信息：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">SSH PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt; </span><span class="token function" style="color:#d73a49">Get-ADDomain</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AllowedDNSSuffixes                 : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ChildDomains                       : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ComputersContainer                 : CN=Computers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DeletedObjectsContainer            : CN=Deleted Objects</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DistinguishedName                  : DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DNSRoot                            : za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DomainControllersContainer         : OU=Domain Controllers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UsersContainer                     : CN=Users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="更改-ad-对象">更改 AD 对象<a href="#更改-ad-对象" class="hash-link" aria-label="更改 AD 对象的直接链接" title="更改 AD 对象的直接链接">​</a></h3>
<p>AD-RSAT cmdlet 的好处之一是，一些甚至允许你创建新的或修改现有的 AD 对象。然而，我们在这个网络中的重点是枚举。创建新对象或修改现有对象将被视为 AD 的利用，这部分将在 AD 模块后面讨论。</p>
<p>不过，我们将通过使用 <code>Set-ADAccountPassword</code> cmdlet 强制更改我们的 AD 用户密码来展示一个例子：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">SSH PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt; </span><span class="token function" style="color:#d73a49">Set-ADAccountPassword</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Identity gordon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">OldPassword </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">ConvertTo-SecureString</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">AsPlaintext </span><span class="token string" style="color:#e3116c">&quot;old&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">force</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">NewPassword </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">ConvertTo-SecureString</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">AsPlainText </span><span class="token string" style="color:#e3116c">&quot;new&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Force</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>记得更改身份值和密码，以及在任务 1 中从分发页面获得的用于枚举的账户。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="好处">好处<a href="#好处" class="hash-link" aria-label="好处的直接链接" title="好处的直接链接">​</a></h3>
<ul>
<li>PowerShell cmdlets 可以枚举比命令提示符中的 net 命令更多的信息。</li>
<li>我们可以使用非域加入的机器上的 runas 指定服务器和域来执行这些命令。</li>
<li>我们可以创建自己的 cmdlets 来枚举特定信息。</li>
<li>我们可以使用 AD-RSAT cmdlets 直接更改 AD 对象，比如重置密码或将用户添加到特定组。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="缺点-1">缺点<a href="#缺点-1" class="hash-link" aria-label="缺点的直接链接" title="缺点的直接链接">​</a></h3>
<ul>
<li>PowerShell 常常比命令提示符更受到蓝队的监控。</li>
<li>我们必须安装 AD-RSAT 工具或使用其他可能可检测到的 PowerShell 枚举脚本。</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><p>Beth Nolan (beth.nolan) 的 Title 属性的值是多少？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\Users\andrea</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mitchell&gt; </span><span class="token function" style="color:#d73a49">Get-ADUser</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Identity beth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nolan </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Properties </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AccountExpirationDate                :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">accountExpires                       : 9223372036854775807</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AccountLockoutTime                   :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AccountNotDelegated                  : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AllowReversiblePasswordEncryption    : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationPolicy                 : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AuthenticationPolicySilo             : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BadLogonCount                        : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">badPasswordTime                      : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">badPwdCount                          : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CannotChangePassword                 : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CanonicalName                        : za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com/People/Sales/beth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nolan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Certificates                         : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">City                                 :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CN                                   : beth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nolan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">codePage                             : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Company                              :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CompoundIdentitySupported            : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Country                              :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">countryCode                          : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created                              : 2/24/2022 10:06:25 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">createTimeStamp                      : 2/24/2022 10:06:25 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deleted                              :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Department                           : Sales</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description                          :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DisplayName                          : Beth Nolan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DistinguishedName                    : CN=beth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nolan</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Sales</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=People</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Division                             :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DoesNotRequirePreAuth                : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dSCorePropagationData                : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">1/1/1601 12:00:00 AM</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EmailAddress                         :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EmployeeID                           :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EmployeeNumber                       :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enabled                              : True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Fax                                  :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GivenName                            : Beth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HomeDirectory                        :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HomedirRequired                      : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HomeDrive                            :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HomePage                             :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HomePhone                            :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Initials                             :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instanceType                         : 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">isDeleted                            :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KerberosEncryptionType               : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LastBadPasswordAttempt               :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LastKnownParent                      :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lastLogoff                           : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lastLogon                            : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LastLogonDate                        :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LockedOut                            : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logonCount                           : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogonWorkstations                    :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Manager                              :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MemberOf                             : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">CN=Internet Access</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Groups</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MNSLogonAccount                      : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MobilePhone                          :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Modified                             : 2/24/2022 10:06:25 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modifyTimeStamp                      : 2/24/2022 10:06:25 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msDS-User-Account-Control-Computed   : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name                                 : beth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nolan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nTSecurityDescriptor                 : System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DirectoryServices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ActiveDirectorySecurity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectCategory                       : CN=Person</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">CN=Schema</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">CN=Configuration</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectClass                          : user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectGUID                           : c4ae7c4c-4f98-4366-b3a1-c57debe3256f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objectSid                            : S-1-5-21-3330634377-1326264276-632209373-2760</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Office                               :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OfficePhone                          :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Organization                         :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OtherName                            :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PasswordExpired                      : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PasswordLastSet                      : 2/24/2022 10:06:25 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PasswordNeverExpires                 : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PasswordNotRequired                  : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POBox                                :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PostalCode                           :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PrimaryGroup                         : CN=Domain Users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">CN=Users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">primaryGroupID                       : 513</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PrincipalsAllowedToDelegateToAccount : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ProfilePath                          :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ProtectedFromAccidentalDeletion      : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pwdLastSet                           : 132902139856391082</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SamAccountName                       : beth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nolan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sAMAccountType                       : 805306368</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ScriptPath                           :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sDRightsEffective                    : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ServicePrincipalNames                : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SID                                  : S-1-5-21-3330634377-1326264276-632209373-2760</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SIDHistory                           : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SmartcardLogonRequired               : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sn                                   : Nolan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">State                                :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StreetAddress                        :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Surname                              : Nolan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Title                                : Senior</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TrustedForDelegation                 : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TrustedToAuthForDelegation           : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UseDESKeyOnly                        : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userAccountControl                   : 512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userCertificate                      : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UserPrincipalName                    :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uSNChanged                           : 28070</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uSNCreated                           : 28066</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">whenChanged                          : 2/24/2022 10:06:25 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">whenCreated                          : 2/24/2022 10:06:25 PM</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Senior</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Annette Manning (annette.manning) 的 DistinguishedName 属性的值是多少？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\Users\andrea</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mitchell&gt; </span><span class="token function" style="color:#d73a49">Get-ADUser</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Identity annette</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">manning </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Properties </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> findstr DistinguishedName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DistinguishedName                    : CN=annette</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">manning</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Marketing</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=People</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CN=annette.manning,OU=Marketing,OU=People,DC=za,DC=tryhackme,DC=com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>第 2 层管理员组何时创建？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\Users\andrea</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mitchell&gt; </span><span class="token function" style="color:#d73a49">Get-ADGroup</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Identity </span><span class="token string" style="color:#e3116c">&quot;Tier 2 Admins&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Properties </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CanonicalName                   : za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com/Groups/Tier 2 Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CN                              : Tier 2 Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created                         : 2/24/2022 10:04:41 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">createTimeStamp                 : 2/24/2022 10:04:41 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deleted                         :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description                     :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DisplayName                     : Tier 2 Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DistinguishedName               : CN=Tier 2 Admins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Groups</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dSCorePropagationData           : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">1/1/1601 12:00:00 AM</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GroupCategory                   : Security</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GroupScope                      : Global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">groupType                       : </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">2147483646</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HomePage                        :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">instanceType                    : 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">isDeleted                       :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LastKnownParent                 :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ManagedBy                       :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">member                          : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">CN=t2_jeremy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">leonard</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=T2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Admins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CN=t2_marian</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">yates</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=T2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Admins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CN=t2_tom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bray</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=T2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Admins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  CN=t2_zoe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">watson</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=T2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Admins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MemberOf                        : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Members                         : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">CN=t2_jeremy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">leonard</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=T2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Admins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CN=t2_marian</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">yates</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=T2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Admins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CN=t2_tom</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bray</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=T2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Admins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                  CN=t2_zoe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">watson</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=T2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">OU=Admins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Modified                        : 2/24/2022 10:06:21 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modifyTimeStamp                 : 2/24/2022 10:06:21 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name                            : Tier 2 Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nTSecurityDescriptor            : System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DirectoryServices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ActiveDirectorySecurity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectCategory                  : CN=</span><span class="token function" style="color:#d73a49">Group</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">CN=Schema</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">CN=Configuration</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectClass                     : </span><span class="token function" style="color:#d73a49">group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ObjectGUID                      : 6edab731-c305-4959-bd34-4ca1eefe2b3f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objectSid                       : S-1-5-21-3330634377-1326264276-632209373-1104</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ProtectedFromAccidentalDeletion : False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SamAccountName                  : Tier 2 Admins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sAMAccountType                  : 268435456</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sDRightsEffective               : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SID                             : S-1-5-21-3330634377-1326264276-632209373-1104</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SIDHistory                      : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uSNChanged                      : 27391</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uSNCreated                      : 12781</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">whenChanged                     : 2/24/2022 10:06:21 PM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">whenCreated                     : 2/24/2022 10:04:41 PM</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2/24/2022 10:04:41 PM</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Enterprise Admins 组的 SID 属性值是多少？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\Users\andrea</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mitchell&gt; </span><span class="token function" style="color:#d73a49">Get-ADGroup</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Identity </span><span class="token string" style="color:#e3116c">&quot;Enterprise Admins&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Server za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Properties </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> findstr SID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SID                             : S-1-5-21-3330634377-1326264276-632209373-519</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SIDHistory                      : </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">S-1-5-21-3330634377-1326264276-632209373-519</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>哪个容器用于存储删除的 AD 对象？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\Users\andrea</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mitchell&gt; </span><span class="token function" style="color:#d73a49">Get-ADDomain</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> findstr Deleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DeletedObjectsContainer            : CN=Deleted Objects</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=za</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=tryhackme</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">DC=com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CN=Deleted Objects,DC=za,DC=tryhackme,DC=com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enumeration-through-bloodhound---通过-bloodhound-进行查点">Enumeration through Bloodhound - 通过 Bloodhound 进行查点<a href="#enumeration-through-bloodhound---通过-bloodhound-进行查点" class="hash-link" aria-label="Enumeration through Bloodhound - 通过 Bloodhound 进行查点的直接链接" title="Enumeration through Bloodhound - 通过 Bloodhound 进行查点的直接链接">​</a></h2>
<p>最后，我们将看看如何使用 <a href="https://github.com/BloodHoundAD/BloodHound" target="_blank" rel="noopener noreferrer">Bloodhound</a> 进行 AD 枚举。Bloodhound 是迄今为止最强大的 AD 枚举工具，自 2016 年发布以来，它彻底改变了 AD 枚举的格局。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bloodhound-history">Bloodhound History<a href="#bloodhound-history" class="hash-link" aria-label="Bloodhound History的直接链接" title="Bloodhound History的直接链接">​</a></h3>
<p>有很长一段时间，红队（和不幸的是，攻击者）占据了上风。以至于微软在其高级威胁防护解决方案中整合了他们自己的 Bloodhound 版本。这一切都归结为以下短语：</p>
<p>“防御者思考的是列表，攻击者思考的是图表。” - 未知</p>
<p>Bloodhound 允许攻击者（现在也包括防御者）以图表格式可视化 AD 环境，节点之间相互连接。每个连接都是一个可能被利用的路径，可以用来达到目标。相比之下，防御者使用列表，比如域管理员的列表或环境中所有主机的列表。</p>
<p>这种基于图表的思维为攻击者打开了一个全新的世界。它允许了一个两阶段的攻击。在第一阶段，攻击者会执行钓鱼攻击以获得枚举 AD 信息的初始入口。这个初始载荷通常非常吵闹，会在攻击者除了窃取枚举数据外无法执行任何操作之前被蓝队发现并隔离。然而，攻击者现在可以离线使用这些数据，以图表形式创建攻击路径，准确展示所需的步骤和跳跃。在第二次钓鱼活动中使用这些信息，一旦取得入侵，攻击者通常可以在几分钟内达到目标。这甚至比蓝队收到第一个警报的时间更快。这就是图表思维的力量，这也是为什么这么多蓝队也开始使用这些类型的工具更好地了解其安全形势。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sharphound">Sharphound<a href="#sharphound" class="hash-link" aria-label="Sharphound的直接链接" title="Sharphound的直接链接">​</a></h3>
<p>通常你会听到用户将 Sharphound 和 Bloodhound 互相等同地提及。但它们并不相同。Sharphound 是 Bloodhound 的枚举工具。它用于枚举的 AD 信息，然后可以在 Bloodhound 中以可视化方式显示。Bloodhound 则是用于显示 AD 攻击图表的实际 GUI。因此，我们首先需要学习如何使用 Sharphound 来枚举 AD，然后才能使用 Bloodhound 可视化地查看结果。</p>
<p>有三种不同的 Sharphound 收集器：</p>
<ul>
<li>Sharphound.ps1 - 用于运行 Sharphound 的 PowerShell 脚本。然而，最新版本的 Sharphound 已停止发布 PowerShell 脚本版本。这个版本适用于远程访问木马（RATs），因为脚本可以直接加载到内存中，避开磁盘上的杀毒软件扫描。</li>
<li>Sharphound.exe - 用于运行 Sharphound 的 Windows 可执行文件版本。</li>
<li>AzureHound.ps1 - 用于运行针对 Azure（微软云计算服务）实例的 Sharphound 的 PowerShell 脚本。Bloodhound 可以接受从 Azure 枚举的数据，以找到与 Azure 身份和访问管理配置相关的攻击路径。</li>
</ul>
<p>注意：你的 Bloodhound 和 Sharphound 版本必须匹配，以获得最佳结果。通常 Bloodhound 会有更新，这意味着无法导入旧的 Sharphound 结果。这个网络是使  用 Bloodhound v4.1.0 创建的。请确保使用这个版本与 Sharphound 结果配套使用。</p>
<p>在评估中使用这些收集器脚本时，很可能会被检测为恶意软件，并引发蓝队的警报。这就是非域加入的 Windows 机器可以帮助的地方。我们可以使用 runas 命令注入 AD 凭据，并指向一个域控制器。由于我们控制这台 Windows 机器，我们可以禁用杀毒软件或为特定文件或文件夹创建例外，这已经在 THMJMP1 机器上为您执行了。你可以在该主机的 C:\Tools\ 目录中找到 Sharphound 二进制文件。我们将使用 SharpHound.exe 版本进行枚举，但你可以随意尝试其他两个。我们将如下执行 Sharphound：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Sharphound</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">CollectionMethods &lt;Methods&gt; </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">Domain za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">ExcludeDCs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>参数解释：</p>
<ul>
<li>CollectionMethods - 确定 Sharphound 将收集什么类型的数据。最常见的选项是 Default 或 All。此外，由于 Sharphound 缓存信息，一旦第一次运行完成，您只能使用 Session 收集方法来检索新的用户会话，以加快进程速度。</li>
<li>Domain - 在这里，我们指定要枚举的域。在某些情况下，您可能希望枚举与您现有域有信任关系的父域或其他域。您可以通过更改此参数告诉 Sharphound 应该枚举哪个域。</li>
<li>ExcludeDCs - 这将指示 Sharphound 不要触及域控制器，从而减少 Sharphound 运行引发警报的可能性。</li>
</ul>
<p>你可以在这里找到所有各种 Sharphound 参数。最好查看其他参数，因为根据你的红队评估情况，可能会需要它们。</p>
<p>使用前一个任务中的 SSH PowerShell 会话，将 Sharphound 二进制文件复制到你的 AD 用户的文档目录中：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">SSH PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt; </span><span class="token function" style="color:#d73a49">copy</span><span class="token plain"> C:\Tools\Sharphound</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe ~\Documents\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\&gt; cd ~\Documents\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\Users\gordon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens\Documents&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们将使用 All 和 Session 收集方法来运行 Sharphound：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">SSH PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\Users\gordon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens\Documents\&gt;SharpHound</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">CollectionMethods All </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">Domain za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">ExcludeDCs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-03-16T19:11:41</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">2898508+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Resolved Collection Methods: </span><span class="token function" style="color:#d73a49">Group</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LocalAdmin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GPOLocalGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LoggedOn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Trusts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ACL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Container</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RDP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ObjectProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DCOM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SPNTargets</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PSRemote</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-03-16T19:11:41</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">3056683+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Initializing SharpHound at 7:11 PM on 3/16/2022</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-03-16T19:11:41</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">6648113+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Flags: </span><span class="token function" style="color:#d73a49">Group</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LocalAdmin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GPOLocalGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LoggedOn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Trusts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ACL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Container</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RDP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ObjectProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DCOM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SPNTargets</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PSRemote</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-03-16T19:11:41</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">8211318+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Beginning LDAP search </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-03-16T19:12:31</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">6981568+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Output channel closed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> waiting </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> output task to complete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Closing writers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-03-16T19:12:32</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">2605943+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Status: 2163 objects finished </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">2163 43</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">26</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Using</span><span class="token plain"> 85 MB RAM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-03-16T19:12:32</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">2605943+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Enumeration finished in 00:00:50</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">4369344</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-03-16T19:12:32</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">5418517+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">SharpHound Enumeration Completed at 7:12 PM on 3/16/2022! Happy Graphing!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sharphound 的枚举大约需要 1 分钟时间。在较大的组织中，这可能需要更长的时间，甚至第一次执行可能需要几个小时。完成后，你会在执行 Sharphound 的相同文件夹中看到一个带有时间戳的 ZIP 文件。</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">SSH PowerShell</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\Users\gordon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens\Documents&gt; </span><span class="token function" style="color:#d73a49">dir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Directory: C:\Users\gordon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stevens\Documents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mode                LastWriteTime         Length Name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">                </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">         </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token plain">a-</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">        3/16/2022   7:12 PM         121027 20220316191229_BloodHound</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token plain">a-</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">        3/16/2022   5:19 PM         906752 SharpHound</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">-</span><span class="token plain">a-</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">        3/16/2022   7:12 PM         360355 YzE4MDdkYjAtYjc2MC00OTYyLTk1YTEtYjI0NjhiZmRiOWY1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>现在我们可以使用 Bloodhound 来摄取这个 ZIP 文件，以图形化方式展示攻击路径。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bloodhound">Bloodhound<a href="#bloodhound" class="hash-link" aria-label="Bloodhound的直接链接" title="Bloodhound的直接链接">​</a></h3>
<p>正如之前提到的，Bloodhound 是一个 GUI 工具，允许我们导入 Sharphound 捕获的数据，并将其可视化为攻击路径。Bloodhound 使用 Neo4j 作为其后端数据库和图形系统。Neo4j 是一个图数据库管理系统。如果你正在使用 AttackBox，你可以使用 Dock 中的红色 Bloodhound 图标来启动它。在其他情况下，请确保 Bloodhound 和 Neo4j 已经安装并配置在你的攻击机器上。无论哪种情况，了解背后发生的事情都是很好的。在我们开始使用 Bloodhound 之前，我们需要加载 Neo4j：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Command Prompt</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">thm@thm:~# neo4j console start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Active database: graph.db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Directories in use:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  home:         /var/lib/neo4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  config:       /etc/neo4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logs:         /var/log/neo4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plugins:      /var/lib/neo4j/plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  import:       /var/lib/neo4j/import</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data:         /var/lib/neo4j/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  certificates: /var/lib/neo4j/certificates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  run:          /var/run/neo4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting Neo4j.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[....]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-03-13 19:59:18.014+0000 INFO  Bolt enabled on 127.0.0.1:7687.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在另一个终端选项卡中运行 <code>bloodhound --no-sandbox</code> 。这将显示给你认证的 GUI 界面：</p>
<div style="text-align:center"><p><img loading="lazy" alt="bloodhound GUI" src="/Tryhackme-CN/assets/images/image_20231209-150938-91fe178cf009f32db4c221b334c91c8d.png" width="492" height="377" class="img_ev3q"></p></div>
<p>neo4j 数据库的默认凭据是 <code>neo4j:neo4j</code> 。使用这些凭据在 Bloodhound 中进行身份验证。要导入我们的结果，你需要从 Windows 主机上恢复 ZIP 文件。最简单的方法是使用你的 AttackBox 上的 SCP 命令：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">scp &lt;AD Username&gt;@THMJMP1.za.tryhackme.com:C:/Users/&lt;AD Username&gt;/Documents/&lt;Sharphound ZIP&gt; .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>提供密码后，这将把结果复制到你当前的工作目录。将 ZIP 文件拖放到 Bloodhound 的 GUI 中以导入 Bloodhound。它会显示正在提取文件并启动导入。</p>
<div style="text-align:center"><p><img loading="lazy" alt="Bloodhound import" src="/Tryhackme-CN/assets/images/image_20231210-151052-4ce8db95276511ca09877de00e94aa64.png" width="622" height="510" class="img_ev3q"></p></div>
<p>一旦所有的 JSON 文件都被导入，我们就可以开始使用 Bloodhound 来枚举这个特定域的攻击路径。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="attack-paths---攻击路劲">Attack Paths - 攻击路劲<a href="#attack-paths---攻击路劲" class="hash-link" aria-label="Attack Paths - 攻击路劲的直接链接" title="Attack Paths - 攻击路劲的直接链接">​</a></h3>
<p>Bloodhound 可以展示多种攻击路径。点击 “Search for a node” 旁边的三条杠将显示选项。第一个选项卡显示了有关我们当前导入的信息。</p>
<div style="text-align:center"><p><img loading="lazy" alt="Bloodhound Attack Paths" src="/Tryhackme-CN/assets/images/image_20231212-151202-65765a7ae4b178b25976bf1984567b83.png" width="423" height="607" class="img_ev3q"></p></div>
<p>请注意，如果导入新的 Sharphound 运行结果，这些计数会累计增加。首先，让我们查看 “节点信息”。让我们在 Bloodhound 中搜索我们的 AD 账户。你必须点击节点来刷新视图。还请注意，你可以通过按下左 Ctrl 键来更改标签方案。</p>
<div style="text-align:center"><p><img loading="lazy" alt="Bloodhound AD Account" src="/Tryhackme-CN/assets/images/image_20231213-151304-62fe7af1af5a0af74edd137a5ca3e247.png" width="748" height="654" class="img_ev3q"></p></div>
<p>我们可以看到有大量关于我们使用情况的信息。每个类别都提供以下信息：</p>
<ul>
<li>概览 - 提供摘要信息，比如账户的活动会话数量以及其是否能够接触到高价值目标。</li>
<li>节点属性 - 显示关于 AD 账户的信息，比如显示名称和职位。</li>
<li>额外属性 - 提供更详细的 AD 信息，比如区分名称和账户创建时间。</li>
<li>组成员资格 - 显示账户所属的群组信息。</li>
<li>本地管理员权限 - 提供有关域加入主机的信息，其中账户具有管理员权限。</li>
<li>执行权限 - 提供特殊权限的信息，比如远程桌面连接到一台机器的能力。</li>
<li>出站控制权限 - 显示此账户有权限修改其属性的 AD 对象信息。</li>
<li>入站控制权限 - 提供能够修改此账户属性的 AD 对象信息。</li>
</ul>
<p>如果你想获得每个类别中更多的信息，你可以点击信息查询旁边的数字。例如，让我们查看与我们账户关联的组成员资格。通过点击 “一级组成员资格” 旁边的数字，我们可以看到我们的账户是两个群组的成员。</p>
<div style="text-align:center"><p><img loading="lazy" alt="Bloodhound AD Account Member of" src="/Tryhackme-CN/assets/images/image_20231214-151422-e6d41b3d94bbd5a808316f4bf9c78b4f.png" width="630" height="177" class="img_ev3q"></p></div>
<p>接下来，我们将查看分析查询。这些查询是 Bloodhound 的创建者编写的，用于枚举有用信息。</p>
<div style="text-align:center"><p><img loading="lazy" alt="Bloodhound AD Account Analysis" src="/Tryhackme-CN/assets/images/image_20231214-151457-9541d52ad92eadfc4e7ef7f7303581dc.png" width="492" height="356" class="img_ev3q"></p></div>
<p>在 “域信息” 部分下，我们可以运行 “查找所有域管理员” 查询。请注意，你可以按下左 Ctrl 键来更改标签显示设置。</p>
<div style="text-align:center"><p><img loading="lazy" alt="Bloodhound icon ad line" src="/Tryhackme-CN/assets/images/image_20231215-151558-27edb00f2d82c382e362b408616f9b9a.png" width="931" height="203" class="img_ev3q"></p></div>
<p>图标称为节点，而线条称为边缘。让我们深入了解一下 Bloodhound 向我们展示的内容。有一个用户名为 T0_TINUS.GREEN 的 AD 用户账户，它是 Tier 0 ADMINS 群组的成员。但是，这个群组是嵌套在 DOMAIN ADMINS 群组中的，这意味着所有属于 Tier 0 ADMINS 群组的用户实际上都是域管理员。</p>
<p>此外，还有一个用户名为 ADMINISTRATOR 的额外 AD 账户，它是 DOMAIN ADMINS 群组的一部分。因此，在我们的攻击表面中有两个账户，我们可能可以尝试牵涉它们以获取 DA 权限。由于 ADMINISTRATOR 账户是一个内置账户，我们可能更专注于用户账户。</p>
<p>在 Bloodhound 中，之前任务中讨论过的每个 AD 对象都可以是一个节点，每个节点都有一个不同的图标来表示它的对象类型。如果我们想要制定攻击路径，我们需要查看当前位置和我们拥有的权限以及我们想要到达的位置之间的可用边缘。Bloodhound 有各种可用的边缘，可以通过过滤图标来访问：</p>
<div style="text-align:center"><p><img loading="lazy" alt="Edge Filtering" src="/Tryhackme-CN/assets/images/image_20231216-151631-f128f7a374ea33eafb93ce2dfa5e9989.png" width="429" height="758" class="img_ev3q"></p></div>
<p>这些也在不断更新，因为发现新的攻击向量。在未来的网络中，我们将研究利用这些不同的边缘。但是，让我们只使用默认和一些特殊边缘来看一个最基本的攻击路径。我们将在 Bloodhound 中运行搜索来枚举攻击路径。点击路径图标以进行路径搜索。</p>
<div style="text-align:center"><p><img loading="lazy" alt="Bloodhound Search" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAekAAABOCAIAAACLwnkiAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABBESURBVHhe7d3/U9N3ngfwT/2EhIR8TEpCKJHY2EAQlqy5zYoHqy09lWqLI1N2dHBosbrrXH+4mbsfd3b2L7gf9oeda2ecOc+tXvd0j469toJsswVRUlI50wYSE4hGgwEiwQ98QmLiJ9v7JPnwzS8IEjw/+HxMZny/P/kknwDx+Xl/Xp/3J3npxx9/JAAAQFBempqO800AABCIdfy/AAAgHMhuAADhQXYDAAgPshsAQHjmzlVSMnGmAQAAzxUmmuBbMzDuBgAQHmQ3AIDwILsBAIQH2Q0AIDzIbgAA4UF2AwAID7IbAEB4ML8bAP7/BK+c+eZ6nBCX727YymbasvLd9Vs1/P1CNn31v0997U8k+e7DSIn+zQ9/WZHLdxfz8Pzu5Wb3yNcnPrs6yXceSbRp94cNxqW8GgB4sbHX206eHYhy8fPzQx/sSv71D2f6pwlCseXdD3cX86tk05Tzi/bvJsiNr9fv2iThl3EvYnJ4jCjeoOC7WcROT4Sn4yzLdx8kEuXmvazKE/HdRa382pxk/F5ycfE4PlQWAJaAve0c4oKbI8njslQiyQTq5KD71uPybkWmbgdGQ3duByfmMooNOVv/s90xxXezS0RGr/f2fWt/zK1v+J5kScH9SMsdd8fHBn2hRcOZVBRX6NbznRfHeO+Zz0dMTQ0VMn4BACyOHfzyD59fT8eJ2lz/egXhbv/SPZHqysobD+/f9PS59hjD7R995ogS2jcPv29JZRQbunr2TPetuMx08Ffv6DLrZBc71nv2k+7xR5VNSO2bTe9b8vnekzw87iZ/89vfZVqSHDLTWJRIrioo1Cx2K1DMHYxkBzvuuWy1XrzU23vlisPpuTEWpbTFipzUXfSQ605uQaa9FOyYZ3CKUlMPvCkC1pNnvvbEizfr5DMHIqz/wifnQ0UmnZxf8ATR2wOeSKFpc8GSXwvAiy1+rfuiayITa9E7N32e6+ORZOZrvO4zf9NsLcvP9lSKqaHv3KP3CWqTeYtWwgavfPrny8OpXUdOYeXPjKtQMyGIdfLiDeIbAzciD349mURX27Rbv/TacuL+g/m/7F/OvempyclFb/eye7QT91u/vBSkzHUHmo8caWmqrymKuTvaHHTqvnFXn8PPpFdbEnak394fivG9BUhxzH2pb5zvAcAqu+dz3pgZS0pKG//pH//lwz2lMwPIuN/tvce3V8O94OVPW3uCi5YQsiR/a/3rGx8Y0Eo27qo3rXBnsdyayfBXH33mzFSoHke3658PLunM6dIEu0+10ZbmfRWzPz0T8ARJrUHsav38+8kkQZJy495DO7TRQG9nj3dkMpYUyzWGqp07SijuLeD64rRbVa0ZsXvFpa/SA9e54CZJlaWx0azkn47Djbu7SbM26KBNjQ0m7mHpcffpHmrvoZpCrhMNOrptzmE6QZBS7ql3VJcoUyN3ZqjTavOFE6S8yGyiPLZwpmbCMn57d68vFEkkxcpi8/ZaU2G2D0UAhC7iaP3469v8YDLf8sGRXxQSI+3H/zxTeiY37fnVwcrs/s/hayb5+lJRYDA0N5BdvZoJb7L/3In2WzN7CllpfVPj5jy+tzRC/BxBpUpJhL19AWZ2OE/pysq0lEi9rXF7MSkvrz/KBTcRH+q29ifK6pqPHDvSYJH6uzpd6V0MSRKM30dWNTbVbdvVUK0hVVWNRxcEd0aS1FTV6Ji+bs9De6aox9rhSBjrmo8ebWmsogJdF+yp8XnU1dnlJ837W44e3meO+/wR/q0wbj/fOULVNHCrN+81Jh1tnUPPYu8OICTTgwOjc+EpWZ9OsjzVXKAlbw34Inw7yyb884P7WVBU7n6rhD8Vllf25jvLDO5HWm52F+882PTB+4vdfl2f3QmCsoranUbS1/GnP548c+58Z68rMP6oKJToaw807TUXSkSESGkwaAg6lC6rcO+BpLLcoqNkTzyjK9NXV2lCdpt/4fNH/e6Q2FCVHjyLqBKLSRXxe8eIeNAfInXmcjX3tDKtxaThj/aCbl+syFKtS9XUJWqTRS8e9gZW5aQ5gGBNep0j8+Jz5JuPf/9v//r7U9YRfgEnGXQPTvPt7MorUGchO5cnr6IqU1F/2VRjyEpCLnvcnfukc5VLnK64DJS+Zt97Lc37d5oNymTIaf3s9KfWoYer3Izf3nHm1KmTnNNdN+feF6SYy22+/QSysh0Wyt9jD87PWiYcJShVupCSIqUoIsYwbCwSSy3mf1iRXClNh3ecoWOJmx0njvM+d0eSqVUBYFb4mjvIN1PyynYdOvgud3urZF7lNnnbeW1V5u4pKvcc2rPxWcc3HxVktspAy83u+Nigy9m/2M0VWJVft0im1pWZanbuO9i8v5z02Rzz//QEwQYvtdnGlNsamg5zmne+Om/SDEkuZQZNBmXaXinxdtvHln1IlZx9BCk11h+br9E8m/wAQEw4BxZMC8jTFG/QFnG3jfkLEjXY7w3zzewSqSob3t/z2qpMLXlWlpvdd6785euv2he7/U/PzWyeH6Y93Rd6A/OrGCKVhiITicSCOkQkFE4oy0z6zDiYHqOfupyltlQbk+5LmYksKakxNxOeHefHGJobeytFUqmUiNIzVfg4TcfSm5RQSnGCnludjTKodgPMF+r3pmdxz8rLm6kFr194fcQdt3N1wpujqKw/VF/6rOObFImyVJhYbnaTklxuGLuYmWujskQqS4a/7+zo8QRpJhqNMuMBp9U+ItYbirjfADegTjA0E2fZVJIywSAXmSzj77GPEOLEI0IzNQDn8jb6+KtUOSJt1Q59tN8xU46T6Y1FCZ/dmSqzs/SQ3UkrDUY1IdHqVQm/080tZplAX//MW0xbbpSHHT0emttEnPZ0nWvtcC1jGiPAWne737cwusXymUJrbt4D9c273oE7fHMVKDbvTcX30o/LV4ikyvfu2Zql3YUQPouKCTjsfa5AOJJIEqRYrizSb9lWlZ6lF/Vbz1l9EdJQ1/yG3Gu12ocnk2JFsWXnDsr9RYc3oa97t9j5X33K+sxUP+6pXOfP2YYT0vLUpML0krSA9WSnuO69uUXRofNn/zosrtw/N0ew2zk8GSPECo1xW22NPlUEYblkttr94QSpKDJbVP6uEUNTg4kbN3B7j85eb2gyQUgVRcaa2m06XGwJkMEOtx9PTdSb5+W/f/+92syHTwUvfvypY8EHJq03v3fs9Q18Z4Xu2P54tusOuWnPB/NnH0ZuXL21/u8qVHx3tYRctoni6s1Pec35yj+LCgBgBdjpcGhqYVlVotDm89cvs9NjoamFR8Xz7n2BIbsBAIRHiNfmAADAg5DdAADCg+wGABAeZDcAgPAguwEAhAfZDQAgPMhuAADhQXYDAAgPshsAQHiQ3QAAwoPsBgAQHmQ3AIDwILsBAIQH2Q0AIDzIbgAA4UF2AwAID7IbAEB4kN0AAMKD7AYAEB5kNwDAKpm+3u8dW/jNytmC7AYAWCV3vRfb/+PE2fZrEwu//D4LkN3PQLDz1L9fGMr63w4AhCA66vjy9MdnLrrC2QyBl6am45kWJRNnGs8Vz/njXcN8ex55+f5DOwr5TrYwfmdYadIr+S6Pcbb+ycYUv9H4dhnFLyJoR2trsLL57TIJv2BxXHa3xatb3ioR8QsA4IUw3P7RZ44o3yFI2UbLm+/UGBTLTwImmuBbM573cbehtintwP4qDSE1vHEg091XpeJXyB7G7+jz0Y/cMZJEyN4zxO/kAACeRjJ6y/7V8RPnOm9MrXwETv7mt7/LtCQ5ZKbxXFmXI0nLzZkY7B/J/cm2MnW6nxx1WDv+0nWp94rD5b+bo9lYIFtHsP4Ln5wfIaNX2y58H99YWZwc6mz7ynr5ysDgnRx55HLrt/dLNxdyQ2V23HPRau22cQ++dosWq4vVsmnnubO2EHvX94OTzq98TTm3T0uE3O77hp/l3nCEVOV6RfqOe6NuN6P5aama230y/h7rBevF3r6rA4Oj0/JXdMrUYJwdd33T1v6N7crAjbvrZD+O3v6bzlySz73EhzeNshXAWjU19J179D7fyfgxPjnsdg4E16le1b685GJH4n6Sb80QZnCwQZu1jy7a2XTk2JEDO1Rjtq5+mlssIkVEzO9LVDY0NVjUjKuzy0+a9ze3HHjLMNLnCCcJMrV7YgOX2myMbkdj89GWA7VFtK3jUpClTA11BrHYUNdyeKf+4QMaylhtlvh67GMP7i1pR4fVR5obWo4ebdlnInxWq5NJLe7vsgXl1QdajjbVGWhvIJZZ+5GbztwFAC+O5KS/5+zxs9+F+f5TEGZ2i7TbG5saqrQyESGi9EatmB4b5zMwSRnMJUqZRBQP+kNivdmklogkypLtlTNFFnbY5ScMFnP6wTKtxaxLBLwh/s7HU1duLyfcl9L7iDnjHg+tNG0rU3JxL1JWVBmkYa+fIZiAn5YaLCVU+vVZyvltP+WmAWCtIddvfKPhna0rqP0K9ICdjQQd1s8/PXUypcMXI2aPJ0gpJU03YrEYIVPOnF6UqFTyTE0oQkcSMfeXx3knOnyJGMM8uZYtKrTUGOKObldqXM1jI5EIIVfK+S5BqSgiGmaIKB0lKKWMXyqj+Jf0tJsGgLWDpDZV7T92pKF6Ux6/5KkIM7vH+y50+SWVbzcdTqkzZqIxjUwVTubM1fBnWty/pGLLgWPz7VvShBGJrrqqiLZ3e2ZPG3PmNvCQeXdldi1Pv2kAWAPIPJ3l3SPvHXz91aeYavIAQWZ3PByKiHXl6UoFQTDh8IOzZ1KkUjERZWYGyfFwOJIJUKlSTkbC47Oj3Xh06SNfSUmNRRWy2wJ8eouUcmlqNJ3pEQTNjblTY28ZJeHG3jPbjtJ05gWuZNMAIGiyDT+vb/rw4C+MK4/tNEFmNymTkYlwaJwl2GjQ0eOPi4lEjD8dOEtSqFMm/A4Pza1FD13qD/PDYFFxhV480mfzMyyXnmNOa2trZ3r6H0mSSYaJxNnFzh5SFTvMlL/Py+eysqxMSTt7PTT3BPFxV58voTHqKYIqLpZHfN8PZbZt99KZbT920wCwhsm0W/b8+ljjrs352YnttOd9juCs5B3vDyOS0i1cMhLrFAXyu0P23p6+/pvTr2z9B1POcP9VRzDPWDg1cIN4zfyaIvWIXLUmN3Stt/fbPvfoS8Ytmqlb0wWmzQU56xTFG/ImvHabzWb/4VZMaa6tLX+Z+5VKxdM3B/73Sv9onqGsYK6QkQi5B+gCU1lBTqafq1bfG+wfia3Xm0vVotxXdPnTvr7Lth77D/5ppam21qTmVpS98kpOaIDfdmllAX3rntZcmi96zKYBYE1iGXrd5rfervtp4QonAz88R/B5v65yZViWFYky2RjsPtXGVLe8jWsbAUBwhHdd5QrEPedPn25zjscJNj7ucvgTGr0WwQ0Aa8KaHncz/p7OHm8okiDECo1xW21NquACACA0D4+713bNBABgLXihaiYAAGsWshsAQHiQ3QAAwoPsBgAQHmQ3AIDwILsBAIQH2Q0AIDzIbgAA4Zm7NiccCmYaACA4er2eb8FahGtzAADWAmQ3AIDwILsBAISGIP4Pt/dRz28yXhAAAAAASUVORK5CYII=" width="489" height="78" class="img_ev3q"></p></div>
<p>我们的起始节点将是我们的 AD 用户名，而结束节点将是 Tier 1 ADMINS 群组，因为该群组对服务器具有管理员权限。</p>
<div style="text-align:center"><p><img loading="lazy" alt="Bloodhound attack path" src="/Tryhackme-CN/assets/images/image_20231218-151800-722fef1349a4dab4a0dab35dd43251a1.png" width="1164" height="239" class="img_ev3q"></p></div>
<p>如果使用所选的边缘过滤器没有可用的攻击路径，Bloodhound 将显示 “未找到结果”。请注意，这也可能是由于 Bloodhound/Sharphound 不匹配，这意味着结果没有被正确地导入。请确保使用 Bloodhound v4.1.0。但在我们的情况下，Bloodhound 显示了一个攻击路径。它显示 T1 ADMINS 中的一个帐户 ACCOUNT 使用他们的凭据认证到 THMJMP1，这是一个工作站，从而打破了层次模型。它还显示了任何属于 DOMAIN USERS 组的用户，包括我们的 AD 账户，都有能力远程桌面连接到这个主机。</p>
<p>我们可以像下面这样利用这个路径：</p>
<ul>
<li>使用我们的 AD 凭据远程桌面连接到 THMJMP1。</li>
<li>在主机上寻找一个提供管理员权限的权限提升向量。</li>
<li>使用管理员权限，我们可以使用凭据窃取技术和工具，比如 Mimikatz。</li>
<li>由于 T1 Admin 在 THMJMP1 上有一个活动会话，我们的凭据窃取将为我们提供关联账户的 NTLM 哈希值。</li>
</ul>
<p>这只是一个简单的例子。在正常情况下，攻击路径可能相对复杂，并需要多个步骤才能达到最终目标。如果你对每个边缘关联的利用感兴趣，下面的 Bloodhound 文档提供了一个很好的指南。Bloodhound 是一个非常强大的 AD 枚举工具，可以深入了解攻击面的 AD 结构。值得花时间来玩耍和学习它的各种功能。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="仅会话数据">仅会话数据<a href="#仅会话数据" class="hash-link" aria-label=" 仅会话数据的直接链接" title="仅会话数据的直接链接">​</a></h3>
<p>AD 结构在大型组织中并不经常改变。可能会有一些新员工加入，但 OU、组、用户和权限的整体结构通常保持不变。</p>
<p>然而，经常变化的是活动会话和登录事件。由于 Sharphound 创建了一个某一时间点的 AD 结构快照，活动会话数据并不总是准确的，因为有些用户可能已经注销了他们的会话，或者新用户可能已经建立了新的会话。这是需要注意的重要事项，这也是为什么我们希望定期执行 Sharphound 的原因。</p>
<p>一个好的方法是，在评估开始时使用 “全部” 收集方法执行 Sharphound，然后每天至少执行两次 Sharphound，使用 “会话” 收集方法。这将为您提供新的会话数据，并确保这些运行更快，因为它们不会再次枚举整个 AD 结构。执行这些会话运行的最佳时间是大约在上午 10:00，当用户喝第一杯咖啡开始工作时，以及下午约在 14:00，当用户结束午餐休息但还没有下班时。</p>
<p>您可以在 Bloodhound 的 “数据库信息” 选项卡上清除停滞的会话数据，方法是在导入这些新的 Sharphound 运行数据之前，点击 “清除会话信息”。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="优点-1">优点<a href="#优点-1" class="hash-link" aria-label="优点的直接链接" title="优点的直接链接">​</a></h3>
<ul>
<li>提供了用于 AD 枚举的图形用户界面。</li>
<li>能够显示枚举的 AD 信息的攻击路径。</li>
<li>提供了对通常需要多次手动查询才能恢复的 AD 对象的更深入见解。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="缺点-2">缺点<a href="#缺点-2" class="hash-link" aria-label="缺点的直接链接" title="缺点的直接链接">​</a></h3>
<ul>
<li>需要执行 Sharphound，这会产生噪音，并经常被杀毒软件或 EDR（终端检测和响应）解决方案检测到。</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Answer the questions below</div><div class="admonitionContent_BuS1"><p>可以使用什么命令来执行 Sharphound.exe 并请求它仅从 za.tryhackme.com 域恢复会话信息而不接触域控制器？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">PS</span><span class="token plain"> C:\Users\andrea</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mitchell\Documents&gt; </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">\Sharphound</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exe </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">CollectionMethods All </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">Domain za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">ExcludeDCs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:08:27</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">5395191+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Resolved Collection Methods: </span><span class="token function" style="color:#d73a49">Group</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LocalAdmin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GPOLocalGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LoggedOn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Trusts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ACL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Container</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RDP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ObjectProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DCOM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SPNTargets</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PSRemote</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:08:27</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">5551950+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Initializing SharpHound at 7:08 AM on 12/10/2023</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:08:27</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">9779965+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Flags: </span><span class="token function" style="color:#d73a49">Group</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LocalAdmin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GPOLocalGroup</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LoggedOn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Trusts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ACL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Container</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RDP</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ObjectProps</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DCOM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SPNTargets</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PSRemote</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:08:28</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">1829092+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Beginning LDAP search </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> za</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tryhackme</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:08:58</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">2211369+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Status: 0 objects finished </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">0 0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Using</span><span class="token plain"> 49 MB RAM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:09:16</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">4630809+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Producer has finished</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> closing LDAP channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:09:16</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">4787107+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">LDAP channel closed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> waiting </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> consumers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:09:16</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">9162321+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Consumers finished</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> closing output channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:09:16</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">9787346+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Output channel closed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> waiting </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> output task to complete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Closing writers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:09:17</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">5121428+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Status: 2159 objects finished </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">2159 44</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">06123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">--</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Using</span><span class="token plain"> 92 MB RAM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:09:17</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">5121428+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">Enumeration finished in 00:00:49</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">3294133</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-12-10T07:09:17</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">8247007+00:00</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">INFORMATION</span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">SharpHound Enumeration Completed at 7:09 AM on 12/10/2023! Happy Graphing!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Sharphound.exe --CollectionMethods All --Domain za.tryhackme.com --ExcludeDCs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>除了 krbtgt 帐户之外，还有多少其他帐户可能是 kerberoastable 的？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><p>首先，先将 Sharphound 的执行结果传回本地</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─[randark@randark-Parrot]─[~]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──╼ $scp za.tryhackme.com\\andrea.mitchell@thmjmp1.za.tryhackme.com:C:/Users/andrea.mitchell/Documents/20231210070914_BloodHound.zip .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">za.tryhackme.com\andrea.mitchell@thmjmp1.za.tryhackme.com&#x27;s password:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20231210070914_BloodHound.zip                                                                                                                                                                            100%  119KB 124.3KB/s   00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─[randark@randark-Parrot]─[~]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──╼ $ls -lh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">总用量 136K</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- 1 randark randark 119K 12 月 10 15:27 20231210070914_BloodHound.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后使用 Neo4j + Bloodhound GUI 进行分析</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─[✗]─[randark@randark-Parrot]─[~]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──╼ $sudo neo4j start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Directories in use:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">home:         /var/lib/neo4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config:       /etc/neo4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logs:         /var/log/neo4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugins:      /var/lib/neo4j/plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import:       /var/lib/neo4j/import</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:         /var/lib/neo4j/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certificates: /var/lib/neo4j/certificates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">licenses:     /var/lib/neo4j/licenses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run:          /var/lib/neo4j/run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting Neo4j.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Started neo4j (pid:4968). It is available at http://localhost:7474</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">There may be a short delay until the server is ready.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="text-align:center"><p><img loading="lazy" alt="Bloodhound Upload Data" src="/Tryhackme-CN/assets/images/image_20231244-154417-133398fdb9c3e302177705e349883e50.png" width="1282" height="832" class="img_ev3q"></p></div><p>使用预构建的分析条件，即可得到：</p><div style="text-align:center"><p><img loading="lazy" alt="Bloodhound kerberoastable" src="/Tryhackme-CN/assets/images/image_20231248-154858-2aa5451a8974cb3cb506e1cc15ab7951.png" width="1280" height="800" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Tier 1 Admins</code> 组的成员有多少台计算机具有管理访问权限？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img loading="lazy" alt="Bloodhound TIER 1 ADMINS" src="/Tryhackme-CN/assets/images/image_20231258-155815-0b4b433a58c79642560ef9df5a1a77dc.png" width="1282" height="832" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>有多少用户是第 2 层管理员组的成员？</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary> 具体操作步骤 </summary><div><div class="collapsibleContent_i85q"><div style="text-align:center"><p><img loading="lazy" alt="Bloodhound TIER 1 ADMINS" src="/Tryhackme-CN/assets/images/image_20231259-155950-e77b700c0e7d35f865bace60ad4b800f.png" width="1282" height="832" class="img_ev3q"></p></div></div></div></details><div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">15</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Conclusion的直接链接" title="Conclusion的直接链接">​</a></h2>
<p>AD 枚举是一个庞大的任务。正确的 AD 枚举对于更好地理解域的结构，并确定可以利用进行权限提升或横向移动的攻击路径至关重要。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="额外的枚举技术">额外的枚举技术<a href="#额外的枚举技术" class="hash-link" aria-label="额外的枚举技术的直接链接" title="额外的枚举技术的直接链接">​</a></h3>
<p>在这个网络中，我们介绍了几种用于枚举 AD 的技术。这绝不是一个详尽的列表。以下是一些也值得一提的枚举技术：</p>
<ul>
<li>LDAP 枚举 - 任何有效的 AD 凭据对都应该能够绑定到域控制器的 LDAP 接口。这将允许您编写 LDAP 搜索查询，以枚举域中的 AD 对象的信息。</li>
<li>PowerView - PowerView 是 PowerSploit 项目的一个重建脚本。尽管该项目不再得到支持，但像 PowerView 这样的脚本在紧要关头执行半手动枚举 AD 对象时非常有用。</li>
<li>Windows Management Instrumentation (WMI) - WMI 可用于从 Windows 主机枚举信息。它有一个称为 “root\directory\ldap” 的提供程序，可用于与 AD 交互。我们可以利用 PowerShell 中的此提供程序和 WMI 来执行 AD 枚举。</li>
</ul>
<p>我们还应该注意，这个课程侧重于完整地枚举 AD 域的结构，而不仅仅集中于识别配置错误和弱点。侧重于识别弱点，比如不安全的共享或层次模型中的破坏，将在未来的课程中讨论。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="缓解措施">缓解措施<a href="#缓解措施" class="hash-link" aria-label="缓解措施的直接链接" title="缓解措施的直接链接">​</a></h3>
<p>AD 枚举极具挑战性，防范起来相当困难。其中许多技术都模拟了正常的网络流量和行为，使得难以区分恶意流量和正常流量。但是，我们可以采取一些措施来检测潜在的恶意行为：</p>
<ul>
<li>强大的 AD 枚举技术（如 Sharphound）在枚举会话信息时会生成大量的登录事件。由于它是 从单个 AD 帐户执行的，这些登录事件将与这个单个帐户关联。如果来自用户帐户的行为是这种类型，我们可以编写检测规则来检测此类行为。</li>
<li>我们可以为特定的 AD 枚举技术所需的工具编写签名检测规则，比如 SharpHound 二进制文件和 AD-RSAT 工具。
除非被我们组织的员工使用，否则我们可以监控组织内 Command Prompt 和 Powershell 的使用情况，以检测未经授权的源可能进行的枚举尝试。</li>
</ul>
<p>值得一提的是，蓝队自己也可以定期使用这些枚举技术来识别 AD 域结构中的缺口和配置错误。如果我们能解决这些配置错误，即使攻击者枚举了我们的 AD，他们也无法找到可用于提权或横向移动的可以利用的配置错误。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/CTF-Archives/Tryhackme-CN/edit/main/docs/Modules/Compromising-Active-Directory/Enumerating-Active-Directory.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Breaching-Active-Directory"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Breaching Active Directory - Active Directory 突破</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Tryhackme-CN/docs/Modules/Compromising-Active-Directory/Lateral-Movement-and-Pivoting"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Lateral Movement and Pivoting - 横向移动和枢纽</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-ad-enumeration---为什么要进行-ad-域枚举" class="table-of-contents__link toc-highlight">Why AD Enumeration - 为什么要进行 AD 域枚举</a><ul><li><a href="#ad-域枚举" class="table-of-contents__link toc-highlight">AD 域枚举</a></li><li><a href="#学习目标" class="table-of-contents__link toc-highlight">学习目标</a></li><li><a href="#获得初始凭据" class="table-of-contents__link toc-highlight">获得初始凭据</a></li></ul></li><li><a href="#credential-injection---凭证注入" class="table-of-contents__link toc-highlight">Credential Injection - 凭证注入</a><ul><li><a href="#windows-vs-linux" class="table-of-contents__link toc-highlight">Windows vs Linux</a></li><li><a href="#何为-runas" class="table-of-contents__link toc-highlight">何为 Runas</a></li><li><a href="#its-always-dns" class="table-of-contents__link toc-highlight">It&#39;s Always DNS</a></li><li><a href="#ip-vs-hostnames" class="table-of-contents__link toc-highlight">IP vs Hostnames</a></li><li><a href="#使用注入的凭据" class="table-of-contents__link toc-highlight">使用注入的凭据</a></li></ul></li><li><a href="#enumeration-through-microsoft-management-console---通过-microsoft-管理控制台进行枚举" class="table-of-contents__link toc-highlight">Enumeration through Microsoft Management Console - 通过 Microsoft 管理控制台进行枚举</a><ul><li><a href="#microsoft-management-console" class="table-of-contents__link toc-highlight">Microsoft Management Console</a></li><li><a href="#users-and-computers" class="table-of-contents__link toc-highlight">Users and Computers</a></li></ul></li><li><a href="#enumeration-through-command-prompt---通过命令提示符进行枚举" class="table-of-contents__link toc-highlight">Enumeration through Command Prompt - 通过命令提示符进行枚举</a><ul><li><a href="#命令提示符" class="table-of-contents__link toc-highlight">命令提示符</a></li><li><a href="#users" class="table-of-contents__link toc-highlight">Users</a></li><li><a href="#groups" class="table-of-contents__link toc-highlight">Groups</a></li><li><a href="#password-policy" class="table-of-contents__link toc-highlight">Password Policy</a></li><li><a href="#优点" class="table-of-contents__link toc-highlight">优点</a></li><li><a href="#缺点" class="table-of-contents__link toc-highlight">缺点</a></li></ul></li><li><a href="#enumeration-through-powershell---通过-powershell-进行枚举" class="table-of-contents__link toc-highlight">Enumeration through PowerShell - 通过 PowerShell 进行枚举</a><ul><li><a href="#powershell" class="table-of-contents__link toc-highlight">Powershell</a></li><li><a href="#users-1" class="table-of-contents__link toc-highlight">Users</a></li><li><a href="#groups-1" class="table-of-contents__link toc-highlight">Groups</a></li><li><a href="#ad-objects" class="table-of-contents__link toc-highlight">AD Objects</a></li><li><a href="#domains" class="table-of-contents__link toc-highlight">Domains</a></li><li><a href="#更改-ad-对象" class="table-of-contents__link toc-highlight">更改 AD 对象</a></li><li><a href="#好处" class="table-of-contents__link toc-highlight">好处</a></li><li><a href="#缺点-1" class="table-of-contents__link toc-highlight">缺点</a></li></ul></li><li><a href="#enumeration-through-bloodhound---通过-bloodhound-进行查点" class="table-of-contents__link toc-highlight">Enumeration through Bloodhound - 通过 Bloodhound 进行查点</a><ul><li><a href="#bloodhound-history" class="table-of-contents__link toc-highlight">Bloodhound History</a></li><li><a href="#sharphound" class="table-of-contents__link toc-highlight">Sharphound</a></li><li><a href="#bloodhound" class="table-of-contents__link toc-highlight">Bloodhound</a></li><li><a href="#attack-paths---攻击路劲" class="table-of-contents__link toc-highlight">Attack Paths - 攻击路劲</a></li><li><a href="#仅会话数据" class="table-of-contents__link toc-highlight">仅会话数据</a></li><li><a href="#优点-1" class="table-of-contents__link toc-highlight">优点</a></li><li><a href="#缺点-2" class="table-of-contents__link toc-highlight">缺点</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a><ul><li><a href="#额外的枚举技术" class="table-of-contents__link toc-highlight">额外的枚举技术</a></li><li><a href="#缓解措施" class="table-of-contents__link toc-highlight">缓解措施</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Tryhackme CN Mirror Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>